<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>车享质量看板</title>
		<link rel="stylesheet" href="theme/css/bootstrap.min.css" type="text/css" />
		<script src="theme/js/jquery-2.0.3.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="theme/js/jquery-2.1.0.js" type="text/javascript" charset="utf-8"></script>
		<script src="theme/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="theme/js/jBootstrapPage.js" type="text/javascript" charset="utf-8"></script>
		<script src="theme/layer/layer.js" type="text/javascript" charset="utf-8"></script>
		<style type="text/css">
			th {
				text-align: center;
				border-top: 1px;
			}
			
			tr {
				border-top: 1px;
				border-bottom: 1px;
			}
			.main{
				width: 95%;
				margin-left: auto;
				margin-right: auto;
			}
			#loading{  
				position:absolute;  
				width:300px;  
				top:150px;  
				margin-left:-150px;
				left:50%;  
				text-align:center;  
				padding:7px 0 0 0;  
				font:bold 11px Arial, Helvetica, sans-serif;  
			} 
		</style>
	</head>

	<body>
		<div class="main" >
			<h2 style="text-align: center;">车享质量看板</h2>
			<div id="main">
				<table id="jiratable" class="table" border="1" cellspacing="1" cellpadding="1">
					<thead>
						<tr>
							<th>序号</th>
							<th>项目</th>
							<th>产品线</th>
							<th>负责人</th>
							<th>Bug总数</th>
							<th>未修复</th>
							<th>待验证</th>
							<th>有效率</th>
							<th>遗漏率</th>
							<th>及时率</th>
							
						</tr>
					</thead>
					<tbody id="qaboardtb"></tbody>
				</table>
			</div>
		</div>
		<div id="loading">  
    		加载中，请稍候...  
    		<img src="theme/images/loading.gif" mce_src="theme/images/loading.gif" alt="loading.." />  
    	</div> 
					
	<script type="text/javascript">
		$(function() {
				$.ajax({
					type: "post",
					url: "jira/bugMain.php",
					async: true,
					success: function(data) {
						//var dataList = data;
						var dataList = eval(data);
						console.log(dataList);
						var tbodydisp = "";
						len = dataList.length;
						
						for(i = 0, len; i < len; i++) {
							tbodydisp += "<tr>";
							tbodydisp += "<td align='center'>" + (i + 1) + "</td>";
							tbodydisp += "<td>" + dataList[i].pname + "</td>";
							tbodydisp += "<td>" + (dataList[i].cname||"未指定") + "</td>";
							tbodydisp += "<td align='center'>" + (dataList[i].uname||"匿名") + "</td>";
							var pkey=dataList[i].pkey;
							tbodydisp += "<td align='center'>";
							tbodydisp += "<a target='_blank' style='text-decoration:underline' href='http://jira.dds.com/issues/?jql=project%20%3D%20"+pkey+"%20AND%20issuetype%20%3D%20Bug'>" + (dataList[i].total||"0") ;
							tbodydisp +=  "</a></td>";
							tbodydisp += "<td align='center'>" + (dataList[i].notclosed||"0") + "</td>";
							tbodydisp += "<td align='center'>" + (dataList[i].resolved||"0") + "</td>";
							if(dataList[i].total){
								var total=dataList[i].total;
								var validPercent = Math.round(dataList[i].valid / total * 10000) / 100.00;
								var prdPercent=Math.round(dataList[i].sumprd / total * 10000) / 100.00;
								var prePercent=Math.round(dataList[i].sumpre / total * 10000) / 100.00;								
							}else{
								var total=0;
								var validPercent ="-";
								var prdPercent="-";
								var prePercent="-";
							}
							if(validPercent>85){
								tbodydisp += "<td align='center' bgcolor='lightgreen'>" +validPercent  + "%"+ "</td>";
							}else if(validPercent<=85 && validPercent>=80){
								tbodydisp += "<td align='center' bgcolor='yellow'>" +validPercent  + "%"+ "</td>";
							}else if(validPercent<80  && validPercent>=0){
								tbodydisp += "<td align='center' bgcolor='red'>" +validPercent  + "%"+ "</td>";
							}else{
								tbodydisp += "<td align='center'>" +validPercent  +"</td>";
							}

							if(prdPercent<5 && prdPercent>=0){
								tbodydisp += "<td align='center' bgcolor='lightgreen'>" +prdPercent  + "%"+ "</td>";
							}else if(prdPercent<=10 && prdPercent>=5){
								tbodydisp += "<td align='center' bgcolor='yellow'>" +prdPercent  + "%"+ "</td>";
							}else if(prdPercent>10){
								tbodydisp += "<td align='center' bgcolor='red'>" +prdPercent  + "%"+ "</td>";
							}else{
								tbodydisp += "<td align='center'>" +prdPercent  +"</td>";
							}
							
							if(prePercent>80){
								tbodydisp += "<td align='center' bgcolor='lightgreen'>" +prePercent  + "%"+ "</td>";
							}else if(prePercent<=80 && prePercent>=60){
								tbodydisp += "<td align='center' bgcolor='yellow'>" +prePercent  + "%"+ "</td>";
							}else if(prePercent<60  && prePercent>=0){
								tbodydisp += "<td align='center' bgcolor='red'>" +prePercent  + "%"+ "</td>";
							}else{
								tbodydisp += "<td align='center'>" +prePercent  +"</td>";
							}
							
							tbodydisp += "</tr>";
						}
						$("#loading").hide();  
						$("#qaboardtb").append(tbodydisp);
					}
				});
			});
		</script>
	</body>

</html>
