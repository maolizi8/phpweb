<!DOCTYPE html>
<html>
	<head>
	<meta charset="UTF-8">
    <title>测试资源管理</title>
	<link rel="stylesheet" type="text/css" href="cxtester/css/bootstrap.min.css" />
   	<link rel="stylesheet" type="text/css" href="cxtester/css/jquery.dataTables.css" />
   	<link rel="stylesheet" type="text/css" href="cxtester/css/dataTables.bootstrap.css" />
   	<script src="cxtester/js/jquery-2.0.3.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="cxtester/js/jquery-2.1.0.js" type="text/javascript" charset="utf-8" ></script>
	<script src="cxtester/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="cxtester/layer/layer.js"  type="text/javascript" charset="utf-8"></script>
	<script src="cxtester/js/jquery.dataTables.js" type="text/javascript" charset="UTF-8"></script>

	<script type="text/javascript">
		
	
 
	$(document).ready(function() {

    	$('#example').DataTable({
    		"searching":false,
    		"lengthChange":false,
			"processing": true,
			//"serverSide": true,
	       	"filter":false,
    		"sort": false,
			"ajax": {
            	"url": "cxtester/testerSelect.php",
            	"type": "POST"
        	},
        	"columns": [
            	{ "data": "index" },
            	{ "data": "name" },
            	{ "data": "status" },
				{ "data": "skill" },
        	],
        	"columnDefs": [
        		{
    				"targets": 2,
    				"createdCell": function (td, cellData, rowData, row, col) {
      					if ( cellData =='锁定' ) {
       						$(td).css('color', 'red')
      					}
    				}
    			},       		
    			{  
                    targets: 4,  
                   // render: function ( data, type, full, meta) { 
                    "render" : function(data, type,row) {
                    	var id = '"' + row.id + '"';
                        html="";
                        html+="&nbsp;<button id='probtn_"+id+"' onclick='selectproj("+id+")'>查看项目</button>";
                        html+="&nbsp;<button type='button' data-addprotid=''  class='addProj' data-target='#addProject'>新增项目</button>";
                        return html;
                    }  
                } ,
//              {
//					// 定义操作列,
//					"targets" : 4,//操作按钮目标列
//					"data" : null,
//					"render" : function(data, type,row) {
//						var id = '"' + row.id + '"';
//						var html = "<a href='javascript:void(0);'  class='delete btn btn-default btn-xs'  ><i class='fa fa-times'></i> 查看</a>"
//						html += "<a href='javascript:void(0);' class='up btn btn-default btn-xs'><i class='fa fa-arrow-up'></i> 编辑</a>"
//						html += "<a href='javascript:void(0);'   onclick='deleteThisRowPapser("+ id + ")'  class='down btn btn-default btn-xs'><i class='fa fa-arrow-down'></i> 删除</a>"
//						return html;
//					}
//				} 
        	],
    		});
		});
	</script>
	<script type="text/javascript">
	function selectproj(tid,id){
		console.log(tid);
		var tr = $("#tr_" + id);
		var phtml = "<tr class='tr'><td colspan='5'><div style='display: none;  height: auto;'>";
		phtml+=	"<table class='table-bordered' border='1' cellspacing='1' cellpadding='1' width='100%' >";
		phtml+="<tr><th width='7%'>序号</th><th width='14%'>项目</th><th width='14%'>开始时间</th><th width='14%'>结束时间</th><th width='7%'>状态</th>";
		phtml+="<th width='14%'>项目经理</th><th width='14%'>所属部门</th><th width='14%'>操作</th></tr>";
		phtml+="<tbody  id='projbody_"+id+"'></tbody></table></div></td></tr>";
		if(tr.next()[0]) {
			if(tr.next().hasClass("tr")) {
				tr.next().find("div").slideToggle(function(){
					$("#probtn_" + id).html("查看项目");
				tr.next().remove();
				});
			} else {
					tr.after(phtml)
					$("#probtn_" + id).html("隐藏项目");
					tr.next().find("div").slideToggle();
				}
		} else {
				tr.after(phtml)
				$("#probtn_" + id).html("隐藏项目");
				tr.next().find("div").slideToggle();
		}
		
		$(function () {  
	        table = $('#example').DataTable({  
            	data: data,  
            	columns: [  
             	   	{"data": "index"},  
             	   	{"data": "project"},  
             	   	{"data": "starttime"},   
               		{"data": "completetime"},
               		{"data": "status"},
               		{"data": "projmanager"} ,
               		{"data": "department"} ,
               		{}
	  			], 
				"columnDefs": [
        		{
    				"targets": 4,
    				"createdCell": function (td, cellData, rowData, row, col) {
      					if ( cellData =='锁定' ) {
       						$(td).css('color', 'red')
      					}
    				}
    			}, 
    			
    			{  
                    targets: 7,  
                    render: function ( data, type, full, meta) {  
                        html="";
                        html+="&nbsp;<button  id='' onclick='selectproj("+data+")'>查看项目</button>";
                        html+="&nbsp;<button type='button' data-addprotid=''  class='addProj' data-target='#addProject'>新增项目</button>";
                        return html;
                    }  
                } 
        	],
		 });
		});
	}
	</script>
	</head>
	<body>
		<div class="container">
			<h2 style="align-content: center; width: 100%;" align="center">测试资源管理</h2>	
			<button type='button' class='addTest' data-target='#addTester' style="float: right;">新增用户</button>
			<p>&nbsp;</p>
		<table id="example" class="table-bordered" cellspacing="0" width="100%">
    		<thead>
       			<tr>
					<th>序号</th>
					<th>姓名</th>
					<th>状态</th>
					<th>技能</th>
					<th width="200px">操作</th>
				</tr>
    		</thead>
   		
		</table>
	</div>

	<!-- 新增用户的弹出层-->
		<div class="modal fade" id="addTester">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">新增用户</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal" role="form" id="addTesterForm">
   							<div class="form-group">
        						<label for="firstname" class="col-sm-2 control-label">名字</label>
        							<div class="col-sm-10">
           								<input type="text" class="form-control" id="name" name="name" placeholder="请输入名字">
         							</div>
     						</div>
    						<div class="form-group">
    							    <label for="lastname" class="col-sm-2 control-label">技能</label>
     							    <div class="col-sm-10">
      							     	<input type="text" class="form-control" id="skill" name="skill" placeholder="请输入技能">
       							  	</div>
     						</div>
    						<div class="form-group">
    							<div class="col-sm-offset-9 col-sm-10">
      							    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
									<button onclick="addTester()" type="button" class="btn btn-primary">确定</button>
      							</div>
     						</div>
   						</form>
					</div>
					
				</div>				
			</div>		
		</div>
		
		<!-- 确定删除用户的提示 -->
		<div class="modal fade" id="delTester">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" >删除用户</h4>
					</div>
					<div class="modal-body" >
						<p>确定要删除该用户吗？</p>
						<p>删除用户后，所属项目也会一起删除哦~</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="delTester()" type="button" class="btn btn-primary">确定</button>
					</div>
				</div>				
			</div>		
		</div>	
				
		<!-- 确定删除项目的提示 -->
		<div class="modal fade" id="delProject">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" >删除项目</h4>
					</div>
					<div class="modal-body" >
						<p>确定要删除吗？</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
						<button onclick="delProject()" type="button" class="btn btn-primary">确定</button>
					</div>
				</div>				
			</div>		
		</div>	
		
		<!-- 新增项目的弹出层-->
		<div class="modal fade" id="addProject">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">新增项目</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal" role="form" id="addProjectForm">
							
							<div class="form-group" >
        						<label for="projectname" class="col-sm-2 control-label">项目名称</label>
        							<div class="col-sm-10">
           								<input type="text" class="form-control" id="aproject" name="project" placeholder="请输入项目名称">
         							</div>
     						</div>
   							<div class="form-group">
        						<label for="starttime" class="col-sm-2 control-label">开始时间</label>
        							<div class="col-sm-10">
           								<input type="date" class="form-control" id="astarttime" name="starttime" placeholder="请输入开始时间">
         							</div>
     						</div>
    						<div class="form-group">
    							    <label for="completetime" class="col-sm-2 control-label">结束时间</label>
     							    <div class="col-sm-10">
      							     	<input type="date" class="form-control" id="acompletetime" name="completetime" placeholder="请输入结束时间">
       							  	</div>
     						</div>
     						<div class="form-group">
     							<label for="projmanager" class="col-sm-2 control-label">项目经理</label>
        							<div class="col-sm-10">
           								<input type="text" class="form-control" id="aprojmanager" name="projmanager" placeholder="请输入项目经理">
         							</div>    
     						</div>
     						<div class="form-group">
     							<label for="department" class="col-sm-2 control-label">事业部</label>
        							<div class="col-sm-10">
           								<input type="text" class="form-control" id="adepartment" name="department" placeholder="请输入事业部">
         							</div>    
     						</div>
    						<div class="form-group">
    							<div class="col-sm-offset-9 col-sm-10">
      							    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
									<button onclick="addProject()" type="button" class="btn btn-primary">确定</button>
      							</div>
     						</div>
   						</form>
					</div>
					
				</div>				
			</div>		
		</div>
		
		<!-- 编辑项目的弹出层-->
		<div class="modal fade" id="editProject">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">编辑项目</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal" role="form" id="editProjectForm">
							
							<div class="form-group" >
        						<label for="projectname" class="col-sm-2 control-label">项目名称</label>
        							<div class="col-sm-10">
           								<input type="text" class="form-control" id="eproject" name="project" placeholder="请输入项目名称">
         							</div>
     						</div>
   							<div class="form-group">
        						<label for="starttime" class="col-sm-2 control-label">开始时间</label>
        							<div class="col-sm-10">
           								<input type="date" class="form-control" id="estarttime" name="starttime" placeholder="请输入开始时间">
         							</div>
     						</div>
    						<div class="form-group">
    							    <label for="completetime" class="col-sm-2 control-label">结束时间</label>
     							    <div class="col-sm-10">
      							     	<input type="date" class="form-control" id="ecompletetime" name="completetime" placeholder="请输入结束时间">
       							  	</div>
     						</div>
     						<div class="form-group">
     							<label for="projmanager" class="col-sm-2 control-label">项目经理</label>
        							<div class="col-sm-10">
           								<input type="text" class="form-control" id="eprojmanager" name="projmanager" placeholder="请输入项目经理">
         							</div>    
     						</div>
     						<div class="form-group">
     							<label for="department" class="col-sm-2 control-label">事业部</label>
        							<div class="col-sm-10">
           								<input type="text" class="form-control" id="edepartment" name="department" placeholder="请输入事业部">
         							</div>    
     						</div>
    						<div class="form-group">
    							<div class="col-sm-offset-9 col-sm-10">
      							    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
									<button onclick="editProject()" type="button" class="btn btn-primary">确定</button>
      							</div>
     						</div>
   						</form>
					</div>
					
				</div>				
			</div>		
		</div>
		
	</body>
		<script type="text/javascript">
	//全局变量
   	var addProTester=0;
   	
   	var delProjId=0;
   	var delPTrId=0;
   	var delPTesterid=0;
   	var delTesterId=0;
   	var delTTrId=0;
   	
   	var editProjId=0;
   	var editPTesterid=0;
   	var editProjname="";
   	var editStart="";
   	var editComplete="";
   	var editManager="";
   	var editDepart="";
   	
   	$(function(){
   		$(document).on("click",".addTest",function(){	//显示添加用户的弹出框
   			//console.log(this);
   			$('#addTester').modal('show');
   		});
   		
   		$(document).on("click",".delTest",function(){	//显示确认删除用户的弹出框
   			//console.log(this);
   			delTesterId =$(this).data("deltesterid");
   			delTTrId=$(this).data("deltetrid");
   			$('#delTester').modal('show');
   		});
   		
   		$(document).on("click",".delProj",function(){	//显示确认删除项目的弹出框
   			//console.log(this);
   			delProjId =$(this).data("delproid");
   			delPTrId=$(this).data("deltrid");
   			delPTesterid=$(this).data("delptesterid");
   			$('#delProject').modal('show');
   		});
   		
   		$(document).on("click",".addProj",function(){	//显示添加项目的弹出框
   			//console.log(this);
   			addProTester=$(this).data("addprotid");
   			console.log(addProTester);
   			$('#addProject').modal('show');
   		});
   		
   		$(document).on("click",".editProj",function(){	//显示编辑项目的弹出框
   			//console.log(this);
   			editProjId=$(this).data("editproid");
   			editPTesterid=$(this).data("edittesterid");
   			editProjname=$(this).data("editproject");
   			editStart=$(this).data("editstart");
   			editComplete=$(this).data("editcomplete");
   			editManager=$(this).data("editmanager");
   			editDepart=$(this).data("editdepartment");
   			
   			$('#editProject').modal('show');
   			
   			$("#eproject").attr("value",editProjname);
   			$("#estarttime").attr("value",editStart);
   			$("#ecompletetime").attr("value",editComplete);
   			$("#eprojmanager").attr("value",editManager);
   			$("#edepartment").attr("value",editDepart);
   			
   		});
   	
   	});
   	
   	function addTester(){	//添加用户的方法
   		$.ajax({	
				type: "post", 
				url: "cxtester/insertTester.php", 
				data:$("#addTesterForm").serialize(),
				async: true, 			
				success: function() {
					//layer.alert("添加用户成功!");
					layer.msg("添加成功",function(){
						window.location.reload();
					});
					
				}
			});	
   		$('#addTester').modal('hide');
   	}
   	
   	function delTester(){	//删除用户的方法
   		console.log(delTesterId);
   		console.log(delTTrId);
   		$.ajax({	
				type: "post", 
				url: "cxtester/deleteTester.php", 
				data:"testerid="+delTesterId,
				async: true, 			
				success: function() {
					layer.msg("删除用户成功",function(){
						//$("#tr_"+delTTrId).remove();
						window.location.reload();
					});
				}
			});	
   		$('#delTester').modal('hide');
   	}
   	function addProject(){	//添加项目的方法
   		$.ajax({	
				type: "post", 
				url: "cxtester/insertProj.php", 
				data:$("#addProjectForm").serialize()+"&testerid="+addProTester,
				
				async: true, 				
				success: function() {
					layer.msg("添加项目成功",function(){
						window.location.reload();
					});
				}
			});	
   		$('#addProject').modal('hide');
   	}
   	
   	function delProject(){	//删除项目的方法
   		//console.log(delProjId);
   		//console.log(delPTrId);
   		$.ajax({	
				type: "post", 
				url: "cxtester/deleteProj.php", 
				data:"id="+delProjId+"&testerid="+delPTesterid,
				async: true, 	//是不是缓存数据			
				success: function() {
					layer.msg("删除项目成功",function(){
						//$("#ptr_"+delPTrId).remove();
						window.location.reload();
					});
				}
			});	
   		$('#delProject').modal('hide');
   	}
   	
   	function editProject(){
   		$.ajax({	
				type: "post", 
				url: "cxtester/editProj.php", 
				data:$("#editProjectForm").serialize()+"&id="+editProjId+"&testerid="+editPTesterid,
				
				async: true, 			
				success: function() {
					//console.log($("#editProjectForm").serialize()+"&id="+editProjId+"&testerid="+editPTesterid);
					layer.msg("编辑项目成功",function(){
						window.location.reload();
					});
				}
				
			});	
   		$('#editProject').modal('hide');
   	}
   	</script>
   	
   	 
</html>
